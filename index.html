<!DOCTYPE html>
<html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> <title>Calculator</title> <link rel="stylesheet" href="https://www.google.com/search?q=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <style> @import url('https://www.google.com/search?q=https://fonts.googleapis.com/css2%3Ffamily%3DPoppins:wght%40300%3B400%3B600%3B700%26display%3Dswap');
    :root {
        --bg-dark: #0f0f13;
        --bg-panel: #1a1a24;
        --primary: #6c5ce7;
        --accent: #00d2d3;
        --glass: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
        --text-main: #ffffff;
        --text-muted: #a4b0be;
        --danger: #ff4757;
        --nav-height: 70px;
    }

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--bg-dark);
        color: var(--text-main);
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    /* UTILS */
    .hidden { display: none !important; }
    .glass-panel {
        background: var(--glass);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }
    
    /* APP CONTAINER */
    #app {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
    }

    /* --- SCREEN: SETUP PIN --- */
    #setup-screen {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle at top right, #2d3436, #000000);
        z-index: 100;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .setup-title { font-size: 24px; margin-bottom: 20px; color: var(--accent); }
    .pin-display {
        display: flex; gap: 15px; margin-bottom: 40px;
    }
    .pin-dot {
        width: 15px; height: 15px;
        border-radius: 50%;
        border: 2px solid var(--primary);
        transition: all 0.2s;
    }
    .pin-dot.filled { background: var(--primary); box-shadow: 0 0 10px var(--primary); }

    /* --- SCREEN: CALCULATOR --- */
    #calculator-screen {
        width: 100%; height: 100%;
        background: var(--bg-dark);
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        padding-bottom: 20px;
    }

    .calc-display {
        flex: 1;
        display: flex;
        justify-content: flex-end;
        align-items: flex-end;
        padding: 30px;
        font-size: 3.5rem;
        font-weight: 300;
        word-break: break-all;
        text-align: right;
    }

    .calc-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        padding: 20px;
    }

    .calc-btn {
        height: 70px;
        border-radius: 50%;
        border: none;
        background: #2d3436;
        color: #fff;
        font-size: 1.5rem;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 4px 4px 10px rgba(0,0,0,0.3), -2px -2px 10px rgba(255,255,255,0.05);
        cursor: pointer;
        transition: transform 0.1s;
    }
    .calc-btn:active { transform: scale(0.95); }
    .calc-btn.operator { color: var(--accent); background: #222; }
    .calc-btn.equal { background: var(--primary); color: #fff; box-shadow: 0 0 15px rgba(108, 92, 231, 0.4); }
    .calc-btn.clear { color: var(--danger); }

    /* --- SCREEN: VAULT --- */
    #vault-screen {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(180deg, #130f40 0%, #000000 100%);
        z-index: 50;
        display: flex;
        flex-direction: column;
        opacity: 0;
        transform: scale(0.9);
        transition: opacity 0.4s ease, transform 0.4s ease;
        pointer-events: none;
    }

    #vault-screen.active {
        opacity: 1;
        transform: scale(1);
        pointer-events: all;
    }

    /* Vault Header */
    .vault-header {
        padding: 30px 20px 50px 20px;
        background: linear-gradient(135deg, rgba(108, 92, 231, 0.2), rgba(0, 0, 0, 0));
        border-bottom-left-radius: 40px;
        border-bottom-right-radius: 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: relative;
    }
    
    .vault-title h1 { font-size: 28px; font-weight: 700; }
    .vault-title span { font-size: 12px; color: var(--text-muted); letter-spacing: 1px; }
    .secure-icon { 
        font-size: 24px; 
        color: var(--accent);
        text-shadow: 0 0 10px var(--accent);
    }

    /* Vault Content Area */
    .vault-content {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        padding-bottom: 90px; /* Space for nav */
    }

    /* Vault Home Grid */
    .vault-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .vault-card {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 10px;
        border: 1px solid var(--glass-border);
        transition: 0.3s;
        aspect-ratio: 1/1;
    }
    .vault-card:active { transform: scale(0.95); background: rgba(255,255,255,0.1); }
    .vault-card i { font-size: 32px; color: var(--accent); margin-bottom: 5px; }
    .vault-card h3 { font-size: 14px; font-weight: 500; }
    
    /* Specific Views */
    .view-section { display: none; width: 100%; height: 100%; flex-direction: column; }
    .view-section.active { display: flex; }
    
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
    .section-title { font-size: 22px; font-weight: 600; }
    .add-btn {
        background: var(--primary);
        width: 40px; height: 40px;
        border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
        box-shadow: 0 4px 10px rgba(108, 92, 231, 0.4);
        cursor: pointer;
    }

    /* Gallery Grid */
    .media-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
    }
    .media-item {
        aspect-ratio: 1/1;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        background: #222;
        cursor: pointer;
    }
    .media-item img, .media-item video {
        width: 100%; height: 100%; object-fit: cover;
    }

    /* Browser & YT */
    .browser-bar {
        display: flex; gap: 10px; margin-bottom: 10px;
    }
    .browser-input {
        flex: 1;
        background: #222;
        border: 1px solid #333;
        border-radius: 20px;
        padding: 10px 15px;
        color: #fff;
        outline: none;
    }
    .iframe-container {
        flex: 1;
        background: #fff;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
    }
    iframe { width: 100%; height: 100%; border: none; }

    /* Games List */
    .game-card {
        background: #222;
        border-radius: 15px;
        margin-bottom: 15px;
        overflow: hidden;
        display: flex;
        align-items: center;
        padding: 10px;
        gap: 15px;
    }
    .game-thumb {
        width: 60px; height: 60px;
        border-radius: 10px;
        background: var(--primary);
        display: flex; justify-content: center; align-items: center;
        font-size: 24px;
    }
    .game-info h4 { font-size: 16px; }
    .game-play-btn {
        margin-left: auto;
        padding: 8px 15px;
        background: var(--accent);
        color: #000;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        cursor: pointer;
    }

    /* Bottom Nav */
    .bottom-nav {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        height: 65px;
        background: rgba(20, 20, 20, 0.9);
        backdrop-filter: blur(15px);
        border-radius: 35px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 0 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .nav-item {
        color: var(--text-muted);
        font-size: 20px;
        padding: 10px;
        transition: 0.3s;
        position: relative;
        cursor: pointer;
    }
    .nav-item.active {
        color: var(--accent);
        transform: translateY(-5px);
    }
    .nav-item.active::after {
        content: '';
        position: absolute;
        bottom: -5px; left: 50%; transform: translateX(-50%);
        width: 5px; height: 5px;
        background: var(--accent);
        border-radius: 50%;
        box-shadow: 0 0 8px var(--accent);
    }

    /* Modal (Full Screen Media) */
    .modal {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #000;
        z-index: 200;
        display: flex; justify-content: center; align-items: center;
        flex-direction: column;
    }
    .modal-controls {
        position: absolute; bottom: 30px; width: 100%;
        display: flex; justify-content: center; gap: 30px;
    }
    .control-btn {
        background: rgba(255,255,255,0.2);
        width: 50px; height: 50px;
        border-radius: 50%;
        display: flex; justify-content: center; align-items: center;
        color: #fff; font-size: 20px;
        cursor: pointer;
    }

</style>


</head> <body>
<div id="app"> <!-- 1. SETUP SCREEN --> <div id="setup-screen" class="hidden"> <div class="setup-title">Set Your Secret PIN</div> <div class="pin-display" id="setup-dots"> <div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div><div class="pin-dot"></div> </div> <div class="calc-grid" style="width: 100%; max-width: 300px;"> <button class="calc-btn" onclick="setupDigit(1)">1</button> <button class="calc-btn" onclick="setupDigit(2)">2</button> <button class="calc-btn" onclick="setupDigit(3)">3</button> <button class="calc-btn" onclick="setupDigit(4)">4</button> <button class="calc-btn" onclick="setupDigit(5)">5</button> <button class="calc-btn" onclick="setupDigit(6)">6</button> <button class="calc-btn" onclick="setupDigit(7)">7</button> <button class="calc-btn" onclick="setupDigit(8)">8</button> <button class="calc-btn" onclick="setupDigit(9)">9</button> <button class="calc-btn clear" onclick="setupClear()">C</button> <button class="calc-btn" onclick="setupDigit(0)">0</button> <button class="calc-btn equal" onclick="savePin()"><i class="fa fa-check"></i></button> </div> </div>
<!-- 2. CALCULATOR SCREEN -->
<div id="calculator-screen">
    <div class="calc-display" id="calc-display">0</div>
    <div class="calc-grid">
        <button class="calc-btn clear" onclick="calcClear()">C</button>
        <button class="calc-btn operator" onclick="calcAppend('%')">%</button>
        <button class="calc-btn operator" onclick="calcAppend('/')">÷</button>
        <button class="calc-btn operator" onclick="calcBack()"><i class="fa fa-backspace"></i></button>
        
        <button class="calc-btn" onclick="calcAppend('7')">7</button>
        <button class="calc-btn" onclick="calcAppend('8')">8</button>
        <button class="calc-btn" onclick="calcAppend('9')">9</button>
        <button class="calc-btn operator" onclick="calcAppend('*')">×</button>
        
        <button class="calc-btn" onclick="calcAppend('4')">4</button>
        <button class="calc-btn" onclick="calcAppend('5')">5</button>
        <button class="calc-btn" onclick="calcAppend('6')">6</button>
        <button class="calc-btn operator" onclick="calcAppend('-')">−</button>
        
        <button class="calc-btn" onclick="calcAppend('1')">1</button>
        <button class="calc-btn" onclick="calcAppend('2')">2</button>
        <button class="calc-btn" onclick="calcAppend('3')">3</button>
        <button class="calc-btn operator" onclick="calcAppend('+')">+</button>
        
        <button class="calc-btn" onclick="calcAppend('.')">.</button>
        <button class="calc-btn" onclick="calcAppend('0')">0</button>
        <button class="calc-btn" onclick="calcAppend('00')">00</button>
        <button class="calc-btn equal" onclick="calcResult()">=</button>
    </div>
</div>

<!-- 3. VAULT SCREEN -->
<div id="vault-screen">
    <!-- Header -->
    <div class="vault-header">
        <div class="vault-title">
            <h1>MyDocs</h1>
            <span>SECURE STORAGE</span>
        </div>
        <i class="fa fa-lock secure-icon" onclick="lockVault()"></i>
    </div>

    <div class="vault-content">
        <!-- HOME -->
        <div id="v-home" class="view-section active">
            <div class="vault-grid">
                <div class="vault-card" onclick="navTo('gallery')">
                    <i class="fa fa-images"></i>
                    <h3>Gallery</h3>
                </div>
                <div class="vault-card" onclick="navTo('video')">
                    <i class="fa fa-play-circle"></i>
                    <h3>Videos</h3>
                </div>
                <div class="vault-card" onclick="navTo('browser')">
                    <i class="fa fa-globe"></i>
                    <h3>Browser</h3>
                </div>
                <div class="vault-card" onclick="navTo('youtube')">
                    <i class="fa-brands fa-youtube"></i>
                    <h3>YouTube</h3>
                </div>
                <div class="vault-card" onclick="navTo('games')">
                    <i class="fa fa-gamepad"></i>
                    <h3>Games</h3>
                </div>
            </div>
        </div>

        <!-- GALLERY -->
        <div id="v-gallery" class="view-section">
            <div class="section-header">
                <span class="section-title">Private Gallery</span>
                <label class="add-btn">
                    <i class="fa fa-plus"></i>
                    <input type="file" hidden accept="image/*" onchange="importFile(this, 'image')">
                </label>
            </div>
            <div class="media-grid" id="gallery-grid"></div>
        </div>

        <!-- VIDEO -->
        <div id="v-video" class="view-section">
            <div class="section-header">
                <span class="section-title">Private Videos</span>
                <label class="add-btn">
                    <i class="fa fa-plus"></i>
                    <input type="file" hidden accept="video/*" onchange="importFile(this, 'video')">
                </label>
            </div>
            <div class="media-grid" id="video-grid"></div>
        </div>

        <!-- BROWSER -->
        <div id="v-browser" class="view-section" style="height: 100%;">
            <div class="browser-bar">
                <input type="text" id="browser-url" class="browser-input" value="https://www.bing.com" placeholder="https://...">
                <div class="add-btn" onclick="loadBrowser()"><i class="fa fa-arrow-right"></i></div>
            </div>
            <div class="iframe-container">
                <iframe id="browser-frame" src=""></iframe>
            </div>
        </div>

        <!-- YOUTUBE -->
        <div id="v-youtube" class="view-section" style="height: 100%;">
            <div class="browser-bar">
                <input type="text" id="yt-search" class="browser-input" placeholder="Search YouTube...">
                <div class="add-btn" onclick="searchYT()"><i class="fa fa-search"></i></div>
            </div>
            <div class="iframe-container">
                <iframe id="yt-frame" src="https://www.youtube.com/embed?listType=search&list=Nature+4k" allowfullscreen></iframe>
            </div>
        </div>

        <!-- GAMES -->
        <div id="v-games" class="view-section">
             <div class="section-header">
                <span class="section-title">Arcade</span>
            </div>
            <!-- Game 1 -->
            <div class="game-card">
                <div class="game-thumb"><i class="fa fa-snowflake"></i></div>
                <div class="game-info"><h4>Yeti Sensation</h4></div>
                <div class="game-play-btn" onclick="playGame('https://gemioli.com/yetisensation/html5/gemioli/')">PLAY</div>
            </div>
             <!-- Game 2 -->
            <div class="game-card">
                <div class="game-thumb"><i class="fa fa-kiwi-bird"></i></div>
                <div class="game-info"><h4>Slinguin</h4></div>
                <div class="game-play-btn" onclick="playGame('https://gemioli.com/slinguin/html5/gemioli/')">PLAY</div>
            </div>
             <!-- Game 3 -->
            <div class="game-card">
                <div class="game-thumb"><i class="fa fa-hat-cowboy"></i></div>
                <div class="game-info"><h4>The Saloon</h4></div>
                <div class="game-play-btn" onclick="playGame('https://gemioli.com/thesaloon/html5/gemioli/')">PLAY</div>
            </div>
        </div>
        
        <!-- GAME FRAME CONTAINER -->
        <div id="v-game-player" class="view-section" style="height: 100%; display:none;">
             <div class="browser-bar">
                <div class="add-btn" onclick="closeGame()"><i class="fa fa-times"></i></div>
                <span style="align-self:center; margin-left:10px;">Playing...</span>
            </div>
            <div class="iframe-container">
                <iframe id="game-frame" src=""></iframe>
            </div>
        </div>

    </div>

    <!-- BOTTOM NAV -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home')"><i class="fa fa-home"></i></div>
        <div class="nav-item" onclick="navTo('gallery')"><i class="fa fa-images"></i></div>
        <div class="nav-item" onclick="navTo('video')"><i class="fa fa-play-circle"></i></div>
        <div class="nav-item" onclick="navTo('browser')"><i class="fa fa-globe"></i></div>
        <div class="nav-item" onclick="navTo('youtube')"><i class="fa-brands fa-youtube"></i></div>
    </div>
</div>


</div>
<!-- MODAL FOR MEDIA VIEWING -->
<div id="media-modal" class="hidden modal"> <div style="flex:1; width:100%; display:flex; justify-content:center; align-items:center;" id="modal-content"></div> <div class="modal-controls"> <div class="control-btn" onclick="closeModal()"><i class="fa fa-times"></i></div> <div class="control-btn" onclick="deleteCurrentMedia()"><i class="fa fa-trash"></i></div> <div class="control-btn" onclick="downloadCurrentMedia()"><i class="fa fa-download"></i></div> </div> </div>
<script> /* --- DB SETUP (IndexedDB) --- */ let db; const request = indexedDB.open("VaultDB", 1);
request.onupgradeneeded = function(event) {
    db = event.target.result;
    db.createObjectStore("images", { keyPath: "id", autoIncrement: true });
    db.createObjectStore("videos", { keyPath: "id", autoIncrement: true });
};

request.onsuccess = function(event) {
    db = event.target.result;
    loadGallery();
    loadVideos();
};

/* --- STATE MANAGEMENT --- */
const PIN_KEY = 'vault_pin';
let currentInput = "";
let setupInput = "";
let isVaultOpen = false;

// Check Initial State
window.onload = function() {
    if (!localStorage.getItem(PIN_KEY)) {
        document.getElementById('setup-screen').classList.remove('hidden');
        document.getElementById('calculator-screen').classList.add('hidden');
    }
};

/* --- SETUP LOGIC --- */
function setupDigit(d) {
    if (setupInput.length < 4) {
        setupInput += d;
        updateSetupDots();
    }
}

function setupClear() {
    setupInput = "";
    updateSetupDots();
}

function updateSetupDots() {
    const dots = document.querySelectorAll('.pin-dot');
    dots.forEach((dot, i) => {
        if (i < setupInput.length) dot.classList.add('filled');
        else dot.classList.remove('filled');
    });
}

function savePin() {
    if (setupInput.length === 4) {
        localStorage.setItem(PIN_KEY, setupInput);
        document.getElementById('setup-screen').classList.add('hidden');
        document.getElementById('calculator-screen').classList.remove('hidden');
    } else {
        alert("Enter 4 digits");
    }
}

/* --- CALCULATOR LOGIC --- */
function calcAppend(val) {
    const display = document.getElementById('calc-display');
    if (display.innerText === '0' && val !== '.') display.innerText = '';
    display.innerText += val;
    currentInput = display.innerText;
}

function calcClear() {
    document.getElementById('calc-display').innerText = '0';
    currentInput = "";
}

function calcBack() {
    let txt = document.getElementById('calc-display').innerText;
    document.getElementById('calc-display').innerText = txt.slice(0, -1) || '0';
    currentInput = document.getElementById('calc-display').innerText;
}

function calcResult() {
    const display = document.getElementById('calc-display');
    const storedPin = localStorage.getItem(PIN_KEY);

    // VAULT UNLOCK CHECK
    if (display.innerText === storedPin) {
        openVault();
        calcClear();
        return;
    }

    // NORMAL CALCULATION
    try {
        // Safe replacement for visual operators
        let expr = display.innerText.replace(/×/g, '*').replace(/−/g, '-').replace(/÷/g, '/');
        display.innerText = eval(expr);
    } catch (e) {
        display.innerText = "Error";
        setTimeout(calcClear, 1000);
    }
}

/* --- VAULT LOGIC --- */
function openVault() {
    isVaultOpen = true;
    document.getElementById('vault-screen').classList.add('active');
    // Load default browser
    loadBrowser();
}

function lockVault() {
    isVaultOpen = false;
    document.getElementById('vault-screen').classList.remove('active');
    navTo('home'); // Reset to home for next time
}

/* --- NAVIGATION --- */
function navTo(page) {
    // Hide all views
    document.querySelectorAll('.view-section').forEach(el => {
        el.classList.remove('active');
        el.style.display = 'none';
    });
    
    // Show selected view
    if(page === 'home') document.getElementById('v-home').classList.add('active');
    else if(page === 'gallery') document.getElementById('v-gallery').classList.add('active');
    else if(page === 'video') document.getElementById('v-video').classList.add('active');
    else if(page === 'browser') document.getElementById('v-browser').classList.add('active');
    else if(page === 'youtube') document.getElementById('v-youtube').classList.add('active');
    else if(page === 'games') document.getElementById('v-games').classList.add('active');

    // Handle flex display explicitly for sections
    document.querySelectorAll('.view-section.active').forEach(el => el.style.display = 'flex');

    // Update Nav Icons
    document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
    // Mapping simple logic for nav highlight
    const idx = ['home','gallery','video','browser','youtube'].indexOf(page);
    if(idx > -1) document.querySelectorAll('.nav-item')[idx].classList.add('active');
}

/* --- MEDIA IMPORTS (IndexedDB) --- */
function importFile(input, type) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const blob = new Blob([e.target.result], { type: file.type });
        const transaction = db.transaction([type + "s"], "readwrite");
        const store = transaction.objectStore(type + "s");
        store.add({ blob: blob, date: new Date() });
        
        transaction.oncomplete = function() {
            if (type === 'image') loadGallery();
            else loadVideos();
            input.value = ""; // reset
        };
    };
    reader.readAsArrayBuffer(file);
}

function loadGallery() {
    const grid = document.getElementById('gallery-grid');
    grid.innerHTML = "";
    const transaction = db.transaction(["images"], "readonly");
    const store = transaction.objectStore("images");
    
    store.openCursor().onsuccess = function(e) {
        const cursor = e.target.result;
        if (cursor) {
            const url = URL.createObjectURL(cursor.value.blob);
            const div = document.createElement('div');
            div.className = 'media-item';
            div.innerHTML = `<img src="${url}">`;
            div.onclick = () => openModal('image', url, cursor.key);
            grid.appendChild(div);
            cursor.continue();
        }
    };
}

function loadVideos() {
    const grid = document.getElementById('video-grid');
    grid.innerHTML = "";
    const transaction = db.transaction(["videos"], "readonly");
    const store = transaction.objectStore("videos");
    
    store.openCursor().onsuccess = function(e) {
        const cursor = e.target.result;
        if (cursor) {
            const url = URL.createObjectURL(cursor.value.blob);
            const div = document.createElement('div');
            div.className = 'media-item';
            div.innerHTML = `<video src="${url}#t=0.1"></video>`; // #t=0.1 generates thumbnail
            div.onclick = () => openModal('video', url, cursor.key);
            grid.appendChild(div);
            cursor.continue();
        }
    };
}

/* --- MODAL / VIEWER --- */
let currentMediaKey = null;
let currentMediaType = null;
let currentMediaUrl = null;

function openModal(type, url, key) {
    const modal = document.getElementById('media-modal');
    const content = document.getElementById('modal-content');
    currentMediaKey = key;
    currentMediaType = type;
    currentMediaUrl = url;

    modal.classList.remove('hidden');
    if (type === 'image') {
        content.innerHTML = `<img src="${url}" style="max-width:100%; max-height:80vh; border-radius:10px;">`;
    } else {
        content.innerHTML = `<video src="${url}" controls autoplay style="max-width:100%; max-height:80vh; border-radius:10px;"></video>`;
    }
}

function closeModal() {
    document.getElementById('media-modal').classList.add('hidden');
    document.getElementById('modal-content').innerHTML = ''; // Stop video
}

function deleteCurrentMedia() {
    if (!confirm("Delete permanently?")) return;
    const storeName = currentMediaType + "s";
    const transaction = db.transaction([storeName], "readwrite");
    transaction.objectStore(storeName).delete(currentMediaKey);
    transaction.oncomplete = () => {
        closeModal();
        if (currentMediaType === 'image') loadGallery();
        else loadVideos();
    };
}

function downloadCurrentMedia() {
    const a = document.createElement('a');
    a.href = currentMediaUrl;
    a.download = "vault_" + Date.now() + (currentMediaType === 'image' ? '.png' : '.mp4');
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

/* --- BROWSER --- */
function loadBrowser() {
    let url = document.getElementById('browser-url').value;
    if (!url.startsWith('http')) url = 'https://' + url;
    document.getElementById('browser-frame').src = url;
}

/* --- YOUTUBE --- */
function searchYT() {
    const query = document.getElementById('yt-search').value;
    const embedUrl = `https://www.youtube.com/embed?listType=search&list=${encodeURIComponent(query)}`;
    document.getElementById('yt-frame').src = embedUrl;
}

/* --- GAMES --- */
function playGame(url) {
    document.getElementById('v-games').style.display = 'none';
    const playerDiv = document.getElementById('v-game-player');
    playerDiv.style.display = 'flex';
    playerDiv.classList.add('active');
    document.getElementById('game-frame').src = url;
}

function closeGame() {
    document.getElementById('game-frame').src = "";
    document.getElementById('v-game-player').style.display = 'none';
    navTo('games');
}


</script>
</body> </html>
